# 同轴电缆长度与终端负载检测装置

​	本仓库用于存放2023年电赛B题（同轴电缆长度与终端负载检测装置）的软件程序。



## 一、总体思路

### 1.同轴电缆长度测量

​	方波信号输入同轴电缆，会产生反射现象，我们能够在信号输入端观察到两段式阶梯波。通过使用不同长度的电缆实验可得，阶梯宽度与电缆长度呈现正相关。

​	我们使用STM32向同轴电缆输入连续方波信号，将所得反射信号（阶梯波）通过电压阈值分别为两级阶梯上升电压中点的TLV3501比较器，得到两路下降沿。

​	将两路下降沿输入FPGA，4个相位时钟每个差开90度分别给计数器计数。将时钟倍频至250M，每个计数分辨率就是4ns。把四个相位的计数器的结果相加，得到精度为1ns的计数器结果。此结果不会超过255，因而选择通过8个IO口直接并行输出。

​	使用STM32的8个IO读取FPGA的输出，处理得出两路下降沿间隔时间，进而通过已知的“阶梯宽度-电缆长度”对应关系，推算出当前电缆长度。

### 2.同轴电缆终端负载测量

……



## 二、STM32F103C8T6接线方法：

* 四线0.96寸OLED屏幕

  * PB7 - I2C1 SDA

  * PB6 - I2C1 SCL

  * 3V3、GND两根电源线


* 外部按键输入

  * PB8 - Length

  * PB9 - Load


* 频率200kHz，占空比50%的方波激励信号输出

  * PA8（TIM1-Channel1）


* FPGA计数结果输入

  * PA0-PA7这8个IO口接FPGA的8个数据输出IO口
    * PA7 是最高有效位（MSB），PA0 是最低有效位（LSB）。

      > PA7 → bit7
      > PA6 → bit6
      > ...
      > PA0 → bit0

* 利用ADC+串联分压原理测电缆终端阻性负载
  * GND---待测负载---B点---50Ω---A点---STM32输出方波的IO
  * A点 - PB0（v1，ADC1-IN8）
  * B点 - PB1（v2，ADC1-IN9）
  * 待测负载 = 50Ω*v2 / (v1-v2)
